var tdsLeads={};
(function(){tdsLeads={items:[],init:function(){tdsLeads.items=[]},item:function(){this.jqueryObj=this.blockUid=void 0;this.showCaptcha=!1;this.captchaSiteKey="";this.acknowledgementCheckboxShow=!0;this.acknowledgementCheckboxMsg='I\'ve read and accept the <a href="#">Privacy Policy</a>.';this.subscribeBtnTxt="Subscribe";this.unSubscribeBtnTxt="Unsubscribe";this.unSubscribedRdrURL=this.subscribedRdrURL="";this.submitHasErrors=this.isSubmit=this.inComposer=this.ajaxSubmit=!1;this.messages={ack_require:"",
captcha_user_score:"",captcha_failed:"",success_subscribe:"",success_unsubscribe:"",input_placeholder:"",unsubscribe_msg:""};this._is_initialized=!1},_initialize_item:function(a){if(!0!==a._is_initialized){var c="g-recaptcha-response-leads-"+a.blockUid,b=jQuery("#"+c);if("show"===tdUtil.getBackendVar("tds_captcha")&&1===b.length){var f=b.attr("data-sitekey");grecaptcha.ready(function(){grecaptcha.execute(f,{action:"validate_captcha"}).then(function(a){document.getElementById(c).value=a})})}a.jqueryObj.on("click",
".tds-submit-btn",function(b){var n=jQuery(this),c=n.data("url"),g=a.jqueryObj.find(".tds-checkbox"),d=a.jqueryObj.find(".tds-messages-error"),h=a.jqueryObj.find(".tds-form"),m=h.find(".tds-input-wrap"),k=!1,p=a.jqueryObj.find(".tds-info");g.length&&(g=a.jqueryObj.find("#pp_checkbox_"+a.blockUid),g.length&&!g.is(":checked")&&(b.preventDefault(),k=!0,d.length?d.find(".tds-message-checkbox").length||d.append('<div class="tds-message tds-message-checkbox">'+a.messages.ack_require+"</div>"):a.jqueryObj.find(".tds-info").prepend('<div class="tds-messages tds-messages-error"><div class="tds-message tds-message-checkbox">'+
a.messages.ack_require+"</div></div>"),setTimeout(function(){var b=jQuery("."+a.blockUid+" .tds-messages");b.length&&(b.addClass("tds-messages-hiding"),setTimeout(function(){b.remove()},300))},3E3)));if(!k){if(a.ajaxSubmit){b.preventDefault();h.addClass("tds-s-content-loading");k=0!==a.jqueryObj.find('input[name="subscribed"]').length;d=a.jqueryObj.find('input[name="list"]');var q=parseInt(d.val());d=a.jqueryObj.find('input[name="rdr_url"]');d={list:q,rdr_url:d.val()};if(k)d.action="unsubscribe";
else{k=a.jqueryObj.find('input[name="email"]');g=a.jqueryObj.find('input[name="double_opt_in"]');var r=a.jqueryObj.find('input[name="g-recaptcha-response"]');Object.assign(d,{email:k.val(),double_opt_in:g.val(),recaptcha_response:r.length?r.val():"",action:"subscribe"})}jQuery.ajax({timeout:1E4,type:"POST",url:tdsLeads.get_rest_endpoint("tds_leads/tds_leads_form_submit","uuid="+tdsLeads.get_unique_id()),beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",window.tds_js_globals.wpRestNonce)},cache:!0,
data:d,dataType:"json",statusCode:{404:function(){console.log("tds leads - ERROR: 404 not found")},500:function(){console.log("tds leads - ERROR: 500 server error")}},success:function(b){var c=b.errors;b=b.result;if(0<Object.keys(c).length){console.log("hi");var d='<div class="tds-messages tds-messages-error">';Object.values(c).map(function(a){d+='<div class="tds-message">'+a+"</div>"});d+="</div>";p.append(d)}else b.hasOwnProperty("new_lead_data")?b.new_lead_data.tds_list_id===q&&(p.append('<div class="tds-messages tds-messages-success"><div class="tds-message">'+
a.messages.success_subscribe+"</div></div>"),h.prepend('<input type="hidden" name="subscribed" value="1">'),m.html('<div class="tds-input-wrap"><div class="tds-unsubscribe-txt">'+tdUtil.b64DecodeUnicode(a.messages.unsubscribe_msg)+"</div></div>"),n.text(a.unSubscribeBtnTxt),h.find(".tds-checkbox").remove(),""!==a.subscribedRdrURL&&window.location.replace(a.subscribedRdrURL)):b.hasOwnProperty("unsubscribed")&&(p.append('<div class="tds-messages tds-messages-success"><div class="tds-message">'+a.messages.success_unsubscribe+
"</div></div>"),h.find('input[name="subscribed"]').remove(),m.html('<input class="tds-input" type="email" name="email" aria-label="email" placeholder="'+a.messages.input_placeholder+'" required>'),a.showCaptcha&&""!==a.captchaSiteKey&&(m.prepend('<input type="hidden" id="g-recaptcha-response-leads-'+a.blockUid+'" name="g-recaptcha-response" data-sitekey="'+a.captchaSiteKey+'"><input type="hidden" name="action" value="validate_captcha">'),grecaptcha.ready(function(){grecaptcha.execute(f,{action:"validate_captcha"}).then(function(a){m.find('input[name="g-recaptcha-response"]').val(a)})})),
a.acknowledgementCheckboxShow&&""!==a.acknowledgementCheckboxMsg&&h.append('<div class="tds-checkbox"><input id="pp_checkbox_'+a.blockUid+'" class="" name="" value="Y" type="checkbox"><label class="checkbox subfield" for="pp_checkbox_'+a.blockUid+'"><span class="tds-check"></span><span class="tds-check-title">'+tdUtil.b64DecodeUnicode(a.acknowledgementCheckboxMsg)+"</span></label></div>"),n.text(a.subscribeBtnTxt),""!==a.unSubscribedRdrURL&&window.location.replace(a.unSubscribedRdrURL));var e=a.jqueryObj.find(".tds-messages");
e.length&&setTimeout(function(){e.addClass("tds-messages-hiding");setTimeout(function(){e.remove()},300)},3E3);h.removeClass("tds-s-content-loading")}})}"undefined"!==typeof c&&(b.preventDefault(),window.location.replace(c))}});a.jqueryObj.find("#pp_checkbox_"+a.blockUid).change(function(){var b=jQuery(this),f=a.jqueryObj.find(".tds-messages-error"),c=f.find(".tds-message-checkbox");b.is(":checked")&&(c.remove(),f.is(":empty")&&f.remove())});a._is_initialized=!0}},addItem:function(a){if("undefined"===
typeof a.blockUid)throw"item.blockUid is not defined";tdsLeads.items.push(a);tdsLeads._initialize_item(a)},deleteItem:function(a){for(var c=0;c<tdsLeads.items.length;c++)if(tdsLeads.items[c].blockUid===a)return tdsLeads.items.splice(c,1),!0;return!1},get_rest_endpoint:function(a,c){return _.isEmpty(window.tds_js_globals.permalinkStructure)?window.tds_js_globals.wpRestUrl+a+"&"+c:window.tds_js_globals.wpRestUrl+a+"?"+c},get_unique_id:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}
return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}})();jQuery().ready(function(){tdsLeads.init()});var tdsStore;
(function(a,c,b){tdsStore={_db:b,_dbName:b,_dbStoreName:b,_indexedDB:b,_isInitialized:!1,init:function(a,b){tdsStore._isInitialized||(tdsStore._indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,tdsStore._indexedDB?(tdsStore._dbName=a,tdsStore._dbStoreName=b):console.log("Your browser doesn't support a stable version of IndexedDB!"),tdsStore._isInitialized=!0)},openDb:function(){if(tdsStore._isInitialized){var a=tdsStore._indexedDB.open(tdsStore._dbName);a.onsuccess=
function(a){tdsStore._db=this.result};a.onupgradeneeded=function(a){a.currentTarget.result.createObjectStore(tdsStore._dbStoreName,{keyPath:"id"})}}},getObjectStore:function(a,b){if(tdsStore._isInitialized)return tdsStore._db.transaction(a,b).objectStore(a)},add:function(a,b){if(tdsStore._isInitialized){a={id:a,content:b};b=tdsStore.getObjectStore(tdsStore._dbStoreName,"readwrite");try{var c=b.put(a)}catch(e){throw console.log(e.name),e;}c.onsuccess=function(a){};c.onerror=function(){}}},get:function(b){var c=
a.Deferred(),f=tdsStore.getObjectStore(tdsStore._dbStoreName,"readwrite");try{var e=f.get(b)}catch(g){throw console.log(g.name),g;}e.onsuccess=function(a){c.resolve(this)};e.onerror=function(){};return c}};tdsStore.init("Leads","Cache");tdsStore.openDb()})(jQuery,_);var tdsMain={};
(function(){tdsMain={init:function(){jQuery("body").on("click",".tds-choose-plan-type",function(a){a.preventDefault();a=jQuery(this);var b=a.data("type");"undefined"!==typeof b&&(a=a.data("url-"+b),"undefined"!==typeof a&&(window.location=a))}).on("click",".tds-switcher",function(){tdsMain.setActivePlan(jQuery(this).val())}).on("click",".tds-choose-plan-type-free",function(a){a.preventDefault();a=jQuery(this);var b=a.data("type");"undefined"!==typeof b&&(a=a.data("url-"+b),"undefined"!==typeof a&&
(window.location=a))}).on("click",".tds-s-table-col-expand",function(a){a=jQuery(this);var b=a.find(".tds-s-table-col-label"),c=a.closest(".tds-s-table-row"),l=c.nextAll(".tds-s-table-row-extra-wrap-info:first");c.length&&l.length&&(b.text(b.text()===window.tds_show_more_info?window.tds_show_less_info:window.tds_show_more_info),a.attr("title",a.attr("title")===window.tds_show_more_info?window.tds_show_less_info:window.tds_show_more_info),c.toggleClass("tds-s-table-row-info-expanded"),c.toggleClass("tds-s-table-row-active"),
l.toggle())}).on("click",".tds-resend-activation-link",function(a){var b=jQuery(this),c=b.siblings(".tds-s-notif-descr"),l=b.siblings(".tds-s-notif-js").text();a=b.data("user");"undefined"!==typeof a&&(b.addClass("tds-s-btn-saving"),jQuery.ajax({type:"POST",url:td_ajax_url,data:{action:"td_resend_subscription_activation_link",user:a},success:function(a,f,d){a=jQuery.parseJSON(a);switch(a[0]){case "resend_activation_link":b.next(".tds-info").show().html(a[2]),1===a[1]?(b.addClass("tds-s-btn-saved"),
c.text(l)):b.removeClass("tds-s-btn-saving")}},error:function(a,b,c){}}))});var a=jQuery(".tds-paypal-button");a.length&&a.each(function(a,c){var b=jQuery(c),f=b.closest(".tds-s-table-row").data("subscription-id");a='tr[data-subscription-id="'+f+'"] .tds-paypal-button';paypal.Buttons({fundingSource:paypal.FUNDING.PAYPAL,createOrder:function(a,c){return c.order.create({purchase_units:[{amount:{value:b.data("value"),currency:b.data("currency")}}],application_context:{shipping_preference:"NO_SHIPPING"}})},
onApprove:function(a,c){return c.order.capture().then(function(a){b.hide();a={order_id:a.id,order_intent:a.intent,order_status:a.status,order_payer_id:a.payer.payer_id,order_payer_given_name:a.payer.name.given_name,order_payer_surname:a.payer.name.surname,order_payer_email:a.payer.email_address,order_payee_id:a.purchase_units[0].payee.merchant_id,order_payee_email:a.purchase_units[0].payee.email_address,order_amount_currency_code:a.purchase_units[0].amount.currency_code,order_amount_value:a.purchase_units[0].amount.value,
order_info:JSON.stringify(a,null,2),order_create_time:a.create_time,order_update_time:a.update_time,order_capture_create_time:a.purchase_units[0].payments.captures[0].create_time,order_capture_update_time:a.purchase_units[0].payments.captures[0].update_time};jQuery.ajax({timeout:1E4,type:"POST",url:tdsMain.get_rest_endpoint("tds_subscription/update_paypal_subscription","uuid="+tdsMain.get_unique_id()),beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",window.tds_js_globals.wpRestNonce)},cache:!1,
dataType:"json",data:{subscriptionId:f,paypalOrderData:a},success:function(a,b,c){"undefined"!==typeof a.error&&console.log(a.error)},error:function(a,b,c){console.log("tds save settings - Error callback - textStatus: "+b+" errorThrown: "+c)}})})}}).render(a)});a=jQuery(".tds-switcher:checked");var c="year";a.length&&(c=a.val());tdsMain.setActivePlan(c)},get_rest_endpoint:function(a,c){return _.isEmpty(window.tds_js_globals.permalinkStructure)?window.tds_js_globals.wpRestUrl+a+"&"+c:window.tds_js_globals.wpRestUrl+
a+"?"+c},get_unique_id:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},setActivePlan:function(a){var c=jQuery(".tds-choose-plan-type").not(".tds-switcher-change"),b=jQuery(".tds_plans_price, .tds_plans_description");c.each(function(b,c){b=jQuery(c);b.data("type",a);"undefined"===typeof b.data("url-"+a)?b.attr("disabled",!0):b.removeAttr("disabled")});b.each(function(b,c){b=jQuery(c);c=b.data("type-from-block");
var f=b.find('[class*="tds-show-plan-"]'),e=b.find(".tds-plan-placeholder"),g=a,d=!1;"undefined"!==typeof c&&""!==c&&"free"!==c&&(g=c);f.length?(f.each(function(a,b){a=jQuery(b);b=a.data("type");"undefined"!==typeof b&&b===g?(a.hasClass("tds-show-plan-visible")||a.addClass("tds-show-plan-visible"),window.location!==window.parent.location&&e.hasClass("tds-plan-placeholder-visible")&&e.removeClass("tds-plan-placeholder-visible"),d=!0):a.removeClass("tds-show-plan-visible")}),!1===d&&window.location!==
window.parent.location&&(e.hasClass("tds-plan-placeholder-visible")||e.addClass("tds-plan-placeholder-visible"))):"free"!==c&&(window.location!==window.parent.location?e.hasClass("tds-plan-placeholder-visible")||e.addClass("tds-plan-placeholder-visible"):b.remove())})},b64EncodeUnicode:function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))},b64DecodeUnicode:function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+
("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))},setStorageItem:function(a,c){tdsStore.add(a,c)},getStorageItem:function(a){return tdsStore.get(a)},setLocalStorageItem:function(a,c){var b=tdsMain._getStorage();b=null===b?{}:JSON.parse(tdsMain.b64DecodeUnicode(b));b[a]=c;tdsMain._setStorage(tdsMain.b64EncodeUnicode(JSON.stringify(b)))},getLocalStorageItem:function(a){var c=tdsMain._getStorage();if(null!==c)try{if(c=JSON.parse(tdsMain.b64DecodeUnicode(c)),c.hasOwnProperty(a))return c[a]}catch(b){}},
clearItem:function(){},_getStorage:function(){return window.localStorage.getItem(window.tdcAdminSettings.themeName)},_setStorage:function(a){window.localStorage.setItem(window.tdcAdminSettings.themeName,a)}}})();jQuery().ready(function(){tdsMain.init()});
